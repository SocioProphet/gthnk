{% extends 'admin/model/edit.html' %}

{% block main_menu %}
{{ super() }}

<ul class="nav nav-tabs">
    <!--<li>
        <a href="{{ url_for('.index_view') }}"><i class="icon-list-alt"></i> {{ _gettext('List') }}</a>
    </li>-->
    <!--<li class="active">
        <a href="{{ url_for('.index_view') }}"><i class="icon-eye-open"></i> Day</a>
    </li>-->
    <li>
        {% if day.yesterday() %}
            <a href="{{ url_for('.day_view', date=day.yesterday().date) }}"><i class="icon-arrow-left"></i> {{day.yesterday().date}}</a>
        {% else %}
            <a href="javascript:void(0)"><i class="icon-remove"></i> earliest</a>
        {% endif %}
    </li>
    <li>
        {% if day.tomorrow() %}
            <a href="{{ url_for('.day_view', date=day.tomorrow().date) }}"><i class="icon-arrow-right"></i> {{day.tomorrow().date}}</a>
        {% else %}
            <a href="javascript:void(0)"><i class="icon-remove"></i> latest</a>
        {% endif %}
    </li>
    <li>
        <a id="edit_button" href="javascript:void(0)"><i class="icon-wrench"></i> Edit</a>
    </li>
</ul>
{% endblock %}

{% block body %}

    {% block model_content %}

<div id="main_content">

<div id="entries_holder">
<div id="entries_scroller">

<a id="entries_anchor" name="entries_anchor"></a>

<div id="entries">
{% filter markdown %}
{{ day_str|safe }}
{% endfilter %}
    <div id="entries_control" class="controllable">
        <div class="viewable">
            <a href="javascript:void(0)"><i class="icon-download"></i></a>
        </div>
        <div class="editable off">
            <a href="/admin/entryview/?sort=0&amp;flt0_2={{day.date}}+00%3A00&amp;flt1_3={{day.date}}+23%3A59"><i class="icon-wrench"></i></a>
        </div>
    </div>
</div>

<div id="pages_inline">
    {% for page in day.pages %}
    <div class="page_attachment">
        <a id="{{ page.sequence }}" name="{{ page.sequence }}"></a>
        <div class="image_container">
            <a href="{{ url_for('.full_pdf', date=day.date, sequence=page.sequence) }}">
                <img src="{{ url_for('.full_pdf', date=day.date, sequence=page.sequence) }}">
            </a>

            <div class="controllable">
                <div class="viewable">
                    <a href="javascript:void(0)"><i class="icon-download"></i></a>
                </div>
                <div class="editable off">
                    <a href='javascript:void(0)'><i class="icon-arrow-up"></i></a>
                    <a href="javascript:void(0)"><i class="icon-arrow-down"></i></a>
                    <a href="javascript:void(0)"><i class="icon-trash"></i></a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

</div>
</div>

<div id="page_list">
    <div id="pages_scroller">
    <div id="page_wrapper">

    <a class="scroll top_of_page" id="journal_scroll" href="#entries_anchor" >Journal</a>

    <form id="upload" action="{{ url_for('.upload_file', date=day.date) }}" method=post enctype=multipart/form-data>

        <fieldset>

        <input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />

        <div>
            <input type="file" id="fileselect" name="fileselect[]" multiple="multiple" />
            <div id="filedrag">attachments</div>
        </div>

        <div id="submitbutton">
            <button type="submit">Upload Files</button>
        </div>

        </fieldset>

    </form>

    <ul>
        {% for page in day.pages %}
        <li>
            <a class="scroll" href="#{{ page.sequence }}">
                <img src="{{ url_for('.thumb_pdf', date=day.date, sequence=page.sequence) }}">
            </a>
        </li>
        {% endfor %}
    </ul>
    </div>

</div>

</div>

</div>

    {% endblock %}

{% endblock %}

{% block head %}
{{ super() }}
<style type="text/css">
    {% include "journal_explorer/filedrag/filedrag.css" %}
</style>

{% endblock %}

{% block tail %}
{{ super() }}
<script>
    {% include "journal_explorer/filedrag/filedrag.js" %}
</script>

<script>
    // http://stackoverflow.com/questions/4198041/jquery-smooth-scroll-to-an-anchor/12714767#12714767
    $(".scroll").click(function(event){
        event.preventDefault();
        var dest=$('#entries_scroller').scrollTop()+($(this.hash).offset().top)-60;
        $('#entries_scroller').animate({scrollTop:dest}, 300,'swing');
     });

    $(".top_of_page").click(function(event){
        $('#pages_scroller').animate({scrollTop:100}, 300,'swing');
    })

    var set_height = function(){
        $("#entries_scroller").css("height", $(window).height()-99);
        $("#pages_scroller").css("height", $(window).height()-57);
        $("#page_wrapper").css("height", $(window).height()+50);
    }

    $("#edit_button").click(function() {
        $(".controllable .viewable").toggleClass("off");
        $(".controllable .editable").toggleClass("off");
        $("#edit_button").toggleClass("active");
    })

    $( window ).resize( set_height );

    set_image_widths = function() {
        // set image widths
        var widths = $(".page_attachment a + div a img").map(function(){
            return $(this).width();
        }).get();

        $(".image_container").each(function(index, value){
            $(value).css("width", widths[index]);
        });
    }

    $( document ).ready( function() {
        set_height();
        $('#pages_scroller').scrollTop(100);
    } );

    $(window).bind("load", function() {
        set_image_widths();
    });

</script>
{% endblock %}

{% block footer %}{% endblock %}