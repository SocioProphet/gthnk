{% extends 'shared/base.html.j2' %}

{% set current_page = 'day-view' %}

{% block content %}

<div id="backdrop" class="container">

  <div class="row">
    <div class="col-xl-1"></div>
    <div class="col-xl-10">
      <a id="entries_anchor" name="entries_anchor"></a>

      <div class="gthnk-card" id="entries">
        <p id="day-of-week">{{day_of_week}}</p>
        {{ day_str|safe }}
      </div>
    </div>
    <div class="col-xl-1"></div>
  </div>

  {% if todo_items %}
  <div class="row">
    <div class="col-xl-1"></div>
    <div class="col-xl-10">
      <div class="gthnk-card" id="agenda">
        <h4>Agenda</h4>
        <ul>
        {% for item in todo_items %}
          <li>
            <input class="form-check-input" type="checkbox"/> {{ item }}
          </li>
        {% endfor %}
        </ul>
      </div>
    </div>
    <div class="col-xl-1"></div>
  </div>
  {% endif %}

</div>

<script>
  var today = "{{ date }}";
  // init_filedrag();

  {% if is_buffer %}
  var mtime = 0;

  function check_buffer(do_reload) {
    $.ajax({
      dataType: "json",
      url: "/buffer/latest.json",
      success: function(data) {
        if (data.timestamp > mtime) {
          mtime = data.timestamp;
          if (do_reload) {
            window.location.reload(true);
          }
        }
      }
    });
  }

  // check the buffer periodically
  setInterval( function() {
    check_buffer(true);
  }, 5000);

  // check the buffer once, right now, just to set the mtime.
  check_buffer(false);
  {% endif %}
</script>

<script src="/static/js/gthnk-explorer.js"></script>

{% endblock %}
